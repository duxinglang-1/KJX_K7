/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 *   gui_virtual_keyboard.h
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   Virtual keyboard - UI component
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

/*
 * This file contains internal UI component API, and is intended to be used by category screen module only. 
 * It's not recommended to be included in application code directly. 
 * For application developers, please include category screen header files instead (e.g., wgui_categories.h).
*/

#ifndef __GUI_VIRTUAL_KEYBOARD_H__
#define __GUI_VIRTUAL_KEYBOARD_H__

/*****************************************************************************
 * include
 ****************************************************************************/
#include "MMI_features.h"
#include "gdi_lcd_config.h"
/* #include "kal_non_specific_general_types.h" */ 
#include "mmi_frm_input_gprot.h"
#include "gui.h"
#include "gui_data_types.h"

#if defined(__MMI_VK_POPUP_HINT__)
#define __MMI_VK_LONGTAP_POPUP_HINT__
#endif

#if defined(__MMI_VIRTUAL_KEYBOARD__)

#if defined(__MMI_UI_VIRTUAL_KEYBOARD_DEFAULT_VERSION_1__)
/*****************************************************************************
 * Following code is for VK V1
 ****************************************************************************/
#include "MMIDataType.h"
#include "gui_data_types.h"
#include "gdi_include.h"
#include "gui_theme_struct.h"
#include "wgui.h"
#include "gui_virtual_keyboard_language_type.h"

#if defined(__MMI_TOUCH_SCREEN__)
/***************************************************************************** 
* Define
*****************************************************************************/
#if defined(__MMI_IME_PLUTO_SLIM__)
#define __MMI_IME_VKV1_SLIM__
#endif


#define  MMI_VKBD_MAX_ROW                          5

#if defined(__MMI_IME_VKV1_SLIM__)
#define  MMI_VKBD_MAX_COLUMN                       10
#else
#define  MMI_VKBD_MAX_COLUMN                       15
#endif
#define  MMI_VKBD_MAX_CUSTOM_KEYS                  30
#define  MMI_VKBD_MAX_DISPLAY_AREA_TEXT_LEN        11
#define  MMI_VKBD_MAX_DEADKEY_INPUT                2
#define  MMI_VKBD_MAX_DISABLED_KEYS                20

#define  MMI_VKBD_GRAYSCALE_VALUE                  0

#if defined(__MMI_MAINLCD_320X480__)
    #define  GUI_VKBD_KEY_TEXT_OFFSET              0
#else
    #define  GUI_VKBD_KEY_TEXT_OFFSET              1
#endif

#ifdef __MMI_VK_POPUP_HINT__
    #define GUI_VKBD_LARGE_ICON_CACHE_WIDTH     (GDI_LCD_WIDTH / 4)
    #define GUI_VKBD_LARGE_ICON_CACHE_HEIGHT    (GDI_LCD_HEIGHT / 4)
#if defined(__MMI_VUI_ENGINE__)
    #define GUI_VKBD_LARGE_ICON_CACHE_SIZE      ((GUI_VKBD_LARGE_ICON_CACHE_WIDTH * GUI_VKBD_LARGE_ICON_CACHE_HEIGHT * 32) >> 3)
#else
    #define GUI_VKBD_LARGE_ICON_CACHE_SIZE      ((GUI_VKBD_LARGE_ICON_CACHE_WIDTH * GUI_VKBD_LARGE_ICON_CACHE_HEIGHT * MMI_MAIN_BASE_LAYER_BITS_PER_PIXEL) >> 3)
#endif

    #if defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__)
        #define GUI_VKBD_LARGE_ICON_ZOOM_ARROW_Y_OFFSET     11
        #define GUI_VKBD_LARGE_ICON_ZOOM_ARROW_X_OFFSET     15
        #define GUI_VKBD_LARGE_ICON_ZOOM_SHADE_X_OFFSET     0
        #define GUI_VKBD_LARGE_ICON_TEXT_OFFSET             5
    #elif defined(__MMI_MAINLCD_320X480__)
        #define GUI_VKBD_LARGE_ICON_ZOOM_ARROW_Y_OFFSET     11
        #define GUI_VKBD_LARGE_ICON_ZOOM_ARROW_X_OFFSET     24
        #define GUI_VKBD_LARGE_ICON_ZOOM_SHADE_X_OFFSET     0
        #define GUI_VKBD_LARGE_ICON_TEXT_OFFSET             0
    #else
        #define GUI_VKBD_LARGE_ICON_ZOOM_ARROW_Y_OFFSET     11
        #define GUI_VKBD_LARGE_ICON_ZOOM_ARROW_X_OFFSET     15
        #define GUI_VKBD_LARGE_ICON_ZOOM_SHADE_X_OFFSET     0
        #define GUI_VKBD_LARGE_ICON_TEXT_OFFSET             0
    #endif
#endif /* __MMI_VK_POPUP_HINT__ */

// TODO: Russian should be handled differently
#if defined(__MMI_LANG_RUSSIAN__) || defined(__MMI_LANG_SPANISH__) || defined(__MMI_LANG_SA_SPANISH__)\
    || defined(__MMI_LANG_FRENCH__) || defined(__MMI_LANG_CA_FRENCH__) || defined(__MMI_LANG_PORTUGUESE__) || defined(__MMI_LANG_SA_PORTUGUESE__) \
    || defined(__MMI_LANG_GERMAN__) || defined(__MMI_LANG_ITALIAN__) || defined(__MMI_LANG_TURKISH__) \
    || defined(__MMI_LANG_POLISH__) || defined(__MMI_LANG_CZECH__) || defined(__MMI_LANG_SLOVAK__) \
    || defined(__MMI_LANG_CROATIAN__) || defined(__MMI_LANG_SLOVENIAN__) || defined(__MMI_LANG_DANISH__) \
    || defined(__MMI_LANG_HUNGARIAN__) || defined(__MMI_LANG_FINNISH__) || defined(__MMI_LANG_ROMANIAN__) \
    || defined(__MMI_LANG_GREEK__) || defined(__MMI_LANG_BULGARIAN__) || defined(__MMI_LANG_MOLDOVAN__) \
    || defined(__MMI_LANG_CATALAN__)|| defined(__MMI_LANG_HAUSA__)|| defined(__MMI_LANG_ICELANDIC__)\
    || defined(__MMI_LANG_AZERBAIJANI__)|| defined(__MMI_LANG_YORUBA__)\
    || defined(__MMI_LANG_NORWEGIAN__)  || defined(__MMI_LANG_LITHUANIAN__)
#define  __MMI_VKBD_EUROPEAN_SUPPORT__

#endif /* European languages */

/***************************************************************************** 
* Typedef 
*****************************************************************************/

#if defined (__MMI_INDIC_VK__)
typedef struct
{
    gui_virtual_keyboard_language_enum cons_matra1;
    gui_virtual_keyboard_language_enum cons_matra2;
    gui_virtual_keyboard_language_enum cons_independentvowel1;
    gui_virtual_keyboard_language_enum cons_independentvowel2;
    gui_virtual_keyboard_language_enum symbols;
} gui_vk_indic_toggle_struct;

typedef enum
{

    GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_NONE
#if defined (__MMI_INDIC_VK_HINDI__)
    ,GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_HINDI
#endif 
#if defined (__MMI_INDIC_VK_TAMIL__)
    ,GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_TAMIL
#endif 
#if defined (__MMI_INDIC_VK_BENGALI__)
    ,GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_BENGALI
#endif 
#if defined (__MMI_INDIC_VK_ASSAMESE__)
    ,GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_ASSAMESE
#endif 
#if defined (__MMI_INDIC_VK_PUNJABI__)
    ,GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_PUNJABI
#endif 
#if defined (__MMI_INDIC_VK_MARATHI__)
    ,GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_MARATHI
#endif 
#if defined (__MMI_INDIC_VK_GUJARATI__)
    , GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_GUJARATI
#endif 
#if defined (__MMI_INDIC_VK_KANNADA__)
    , GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_KANNADA
#endif 
#if defined (__MMI_INDIC_VK_ORIYA__)
        , GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_ORIYA
#endif 
#if defined (__MMI_INDIC_VK_MALAYALAM__)
        , GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_MALAYALAM
#endif 
#if defined (__MMI_INDIC_VK_TELUGU__)
        , GUI_VIRTUAL_KEYBOARD_LANGUAGE_ID_TELUGU
#endif 
} gui_virtual_keyboard_indic_enum;
extern const gui_vk_indic_toggle_struct gui_vk_indic_toggle_table[];

#endif /* defined (__MMI_INDIC_VK__) */ 

/* Flags */
/* <group dom_virtual_keyboard_macro> */
/* Flag - multi-block handwriting mode enabled */
#define GUI_VKBD_FLAG_MULTI_BLOCK_MODE          0x00000001
/* <group dom_virtual_keyboard_enum> */
typedef enum
{
    GUI_VKBD_DISPLAY_CALLBACK_START,
    GUI_VKBD_DISPLAY_CALLBACK_IMG,
    GUI_VKBD_DISPLAY_CALLBACK_TEXT,
    GUI_VKBD_DISPLAY_CALLBACK_END
} gui_vkbd_display_callback_type_enum;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    S16 nInputLen;
    UI_character_type input_char[MMI_VKBD_MAX_DEADKEY_INPUT];
    UI_character_type output_char;
} gui_dead_key_symbol_struct, *gui_dead_key_symbol_struct_p;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    gui_virtual_keyboard_language_enum lang;
    const gui_dead_key_symbol_struct *dead_key_symbol;
    S16 nentry;
} gui_dead_key_map_struct, *gui_dead_key_map_struct_p;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* Index of matrix layout tapped by pen (<0 if none) */
    S16 matrix_index;
    S16 matrix_column;
    S16 matrix_row;

    /* Index of custom key tapped by pen (<0 if none) */
    S16 custom_key_index;

    /* size of selected key */
    S16 key_width;
    S16 key_height;
    S16 key_x;
    S16 key_y;
    
#ifdef __MMI_VK_POPUP_HINT__
    S16 enlarged_key_x;
    S16 enlarged_key_y;
    S16 enlarged_key_width;
    S16 enlarged_key_height;
    MMI_BOOL is_enlarging;
    PU8 enlarged_bg;
#endif /* __MMI_VK_POPUP_HINT__ */
} virtual_keyboard_selection_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct _virtual_keyboard_struct
{
    S16 x, y;
    S16 width, height;
    U32 flags;
    gui_virtual_keyboard_language_enum lang_type;
    UI_virtual_keyboard_theme *keyboard_theme;
    UI_character_type disp_area_text[MMI_VKBD_MAX_DISPLAY_AREA_TEXT_LEN + 1];

    /* 
     * If `allowed_characters' is not NULL, the parameters `disabled_chars' and `disabled_symbols'
     * will be ignored. 
     * 
     * It only enables characters listed in `allowed_characters'
     * and special custom keys: GUI_VKBD_PEN_HIDE, GUI_VKBD_PEN_SHOW, 
     * GUI_VKBD_PEN_CAPSLOCK, GUI_VKBD_PEN_BAKSPACE.
     *
     * Custom key GUI_VKBD_PEN_NEWLINE and GUI_VKBD_PEN_SPACE are enabled 
     * if '\n' and ' ' are listed. 
     *
     * Custom key GUI_VKBD_PEN_SYMBPICKER is enabled if any non-alphanumeric characters is listed.
     *
     * `allowed_characters' may contain "-" for consecutive characters
     * (Ex. "a-z" for characters from a to z.)
     * If we want to accept "-", please write it as "\-" 
     * For example, "\-0-9." represents "-0123456789."
     */
    const UI_character_type *allowed_characters;

    /* Null-terminated list for disabled characters */
    UI_character_type disabled_chars[MMI_VKBD_MAX_DISABLED_KEYS + 1];
    /* Terminated with GUI_VKBD_PEN_NONE */
    gui_virtual_keyboard_pen_enum disabled_symbols[MMI_VKBD_MAX_DISABLED_KEYS + 1];

    MMI_BOOL key_down_accepted;

    /* Dead key character */
    UI_character_type dead_key_input[MMI_VKBD_MAX_DEADKEY_INPUT];

    MMI_BOOL selected_key_cached;
    virtual_keyboard_selection_struct selected_key;
    gdi_image_cache_bmp_struct selected_key_bitmap;
    void (*hide_callback) (S32 x1, S32 y1, S32 x2, S32 y2); /*hide function*/
    /* virtual keyboard display callback used to get key's info dynamiclly */
    void (*display_callback)(gui_vkbd_display_callback_type_enum *flag, PU8 *content);
#ifdef __MMI_VK_POPUP_HINT__
    MMI_BOOL active;    
    MMI_BOOL is_cursor_stop;
    MMI_BOOL (*hide_cursor_callback) (S32 x1, S32 y1, S32 x2, S32 y2);
    void (*blink_cursor_callback) (void);
    gdi_image_cache_bmp_struct selected_key_enlarged_bitmap;
#endif /* __MMI_VK_POPUP_HINT__ */
#if defined(__MMI_VUI_ENGINE__)
    MMI_BOOL is_venus_vk;
#endif
} virtual_keyboard;

/* <group dom_virtual_keyboard_struct> */
/* Layout definition */
typedef struct
{
    S16 x, y;
    S16 n_columns, n_rows;
    S16 width, height;
    S16 key_width, key_height;
    S16 horizontal_key_gap, vertical_key_gap;
} gui_matrix_key_layout_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    S16 x, y;
    S16 key_width, key_height;
} gui_custom_key_layout_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    S16 width;
    S16 height;
    S16 n_matrix_key_layout;
    S16 n_custom_keys;
    const gui_matrix_key_layout_struct *matrix_layout;
    const gui_custom_key_layout_struct *custom_keys;
    U16 ImageId;
} gui_keyboard_layout_struct;

/* <group dom_virtual_keyboard_struct> */
#if defined(__MMI_IME_VKV1_SLIM__)
typedef struct
{
    BOOL enable_dead_key;   /* Dead key for european languages */
    S16 n_matrix_layout;
    S16 n_custom_keys;
    const UI_character_type (*matrix_string)[MMI_VKBD_MAX_COLUMN + 1];
    const UI_character_type *custom_string;
    const MMI_ID_TYPE *custom_key_image;
    const gui_virtual_keyboard_pen_enum *custom_key_type;
} gui_keyboard_language_struct;
#else
typedef struct
{
    BOOL enable_dead_key;   /* Dead key for european languages */
    S16 n_matrix_layout;
    S16 n_custom_keys;
    UI_character_type matrix_string[MMI_VKBD_MAX_ROW][MMI_VKBD_MAX_COLUMN + 1];
    UI_character_type custom_string[MMI_VKBD_MAX_CUSTOM_KEYS];
    MMI_ID_TYPE custom_key_image[MMI_VKBD_MAX_CUSTOM_KEYS];
    gui_virtual_keyboard_pen_enum custom_key_type[MMI_VKBD_MAX_CUSTOM_KEYS];
} gui_keyboard_language_struct;
#endif

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    gui_virtual_keyboard_language_enum lang;
    const gui_keyboard_layout_struct *virtual_keyboard_layout;
    const gui_keyboard_language_struct *virtual_keyboard_language;
} gui_keyboard_lang_map_struct, *gui_keyboard_lang_map_struct_p;

/***************************************************************************** 
* Extern Global Variable
*****************************************************************************/

extern UI_virtual_keyboard_theme *current_virtual_keyboard_theme;

/***************************************************************************** 
* Extern Global Function
*****************************************************************************/

extern void gui_set_virtual_keyboard_current_theme(virtual_keyboard *v);
extern void gui_set_virtual_keyboard_theme(virtual_keyboard *v, UI_virtual_keyboard_theme *t);

extern void gui_create_virtual_keyboard(
                virtual_keyboard *v,
                S16 x,
                S16 y,
                gui_virtual_keyboard_language_enum lang_type,
                MMI_BOOL is_venus);
extern void gui_move_virtual_keyboard(virtual_keyboard *v, S16 x, S16 y);
extern void gui_show_virtual_keyboard(virtual_keyboard *v);

extern void gui_set_virtual_keyboard_allowed_characters(virtual_keyboard *v, const UI_character_type *allowed_chars);
extern void gui_set_virtual_board_disable_list(
                virtual_keyboard *v,
                const UI_character_type *disabled_chars,
                const gui_virtual_keyboard_pen_enum *disabled_symbols);

extern void gui_set_virtual_keyboard_display_area(virtual_keyboard *v, const U8 *string, BOOL redraw);

extern void gui_set_virtual_keyboard_multi_block_mode(virtual_keyboard *v, MMI_BOOL enabled);

extern BOOL gui_virtual_keyboard_translate_pen_event(
                virtual_keyboard *v,
                S16 x,
                S16 y,
                mmi_pen_event_type_enum pen_event,
                gui_virtual_keyboard_pen_enum *vkbd_event,
                gui_pen_event_param_struct *vkbd_param);
extern MMI_BOOL gui_virtual_keyboard_get_current_character(
                 virtual_keyboard *v,
                 S16 x,
                 S16 y,
                 UI_character_type *ch);
extern void gui_close_virtual_keyboard(virtual_keyboard *v);
extern void gui_virtual_keyboard_register_hide_callback(
             virtual_keyboard *v,
             void (*f) (S32 x1, S32 y1, S32 x2, S32 y2));
extern void gui_virtual_keyboard_register_display_callback(
             virtual_keyboard *v,
             void (*f) (gui_vkbd_display_callback_type_enum *flag, PU8 *content));
#ifdef __MMI_VK_POPUP_HINT__
extern void gui_virtual_keyboard_register_hide_cursor_callback(
             virtual_keyboard *v,
             MMI_BOOL (*f) (S32 x1, S32 y1, S32 x2, S32 y2));
extern void gui_virtual_keyboard_register_blink_cursor_callback(
             virtual_keyboard *v,
             void (*f) (void));
extern void gui_virtual_keyboard_recover_covered_area(virtual_keyboard *v);
extern MMI_BOOL gui_virtual_keyboard_show_popup_content(virtual_keyboard *v, S32 x, S32 y, S32 width, S32 height, PU8 bgimg);
#endif /* __MMI_VK_POPUP_HINT__ */
extern void gui_virtual_keyboard_recache(virtual_keyboard *v);
extern void gui_virtual_keyboard_draw_from_cache(virtual_keyboard *v);
#endif /* defined(__MMI_TOUCH_SCREEN__) */

#endif /* __MMI_UI_VIRTUAL_KEYBOARD_DEFAULT_VERSION_1__ */

#if defined(__MMI_UI_VIRTUAL_KEYBOARD_DEFAULT_VERSION_2__)
/*****************************************************************************
 * Following code is for VK V2
 ****************************************************************************/

#include "MMIDataType.h"
#include "gui_data_types.h"
#include "gdi_include.h"
#include "gui_theme_struct.h"
#include "wgui.h"
#include "gui_virtual_keyboard_language_type.h"

#if defined(__MMI_TOUCH_SCREEN__)
/***************************************************************************** 
* Define
*****************************************************************************/
#if defined(__MMI_VECTOR_FONT_SUPPORT__)
#define VKBD_DIFF_HALF(a, b)  ((a) >= (b) ? (((a) - (b)) - (((a)-(b)) >> 1)) : 0)
#else
#define VKBD_DIFF_HALF(a, b)  ((a) >= (b) ? (((a)-(b)) >> 1) : 0)
#endif /* __MMI_VECTOR_FONT_SUPPORT__ */

#define GUI_VIRTUAL_KEYBOARD_MAX_DISPLAY_AREA_TEXT_LEN      11
#define MMI_VKBD_MAX_DISPLAY_AREA_TEXT_LEN                  GUI_VIRTUAL_KEYBOARD_MAX_DISPLAY_AREA_TEXT_LEN

//To do: we'd better move this width to oem layer
#define GUI_VIRTUAL_KEYBOARD_KEY_FRAME_WIDTH                1

#define GUI_VIRTUAL_KEYBOARD_MAX_DISABLED_KEYS              20
#define GUI_VIRTUAL_KEYBOARD_MAX_DEAD_KEYS                  8

#define GUI_VIRTUAL_KEYBOARD_STATE_CLOSE                    0x00000000
#define GUI_VIRTUAL_KEYBOARD_STATE_ACTIVE                   0x00000001
#define GUI_VIRTUAL_KEYBOARD_STATE_HIDE                     0x00000002
#define GUI_VIRTUAL_KEYBOARD_STATE_MULTI_BLOCK              0x00000010
#define GUI_VIRTUAL_KEYBOARD_DRAW_KEY_BY_IMAGE              0x00000020

#define GUI_VIRTUAL_KEYBOARD_INVALID_KEY_INDEX              -1

#define GUI_VIRTUAL_KEYBOARD_CONTENT_BORDER_GAP             2
#define GUI_VIRTUAL_KEYBOARD_CONTENT_ITEM_GAP               2

#define GUI_VIRTUAL_KEYBOARD_GRADIENT_ALPHA_PERCENT         30

#define GUI_VIRTUAL_KEYBOARD_CELL_CACHE_WIDTH       (GDI_LCD_WIDTH / 2)
#define GUI_VIRTUAL_KEYBOARD_CELL_CACHE_HEIGHT      (GDI_LCD_HEIGHT / 8)

#if defined(__MMI_VUI_ENGINE__)
#define GUI_VIRTUAL_KEYBOARD_CELL_CACHE_SIZE        ((GUI_VIRTUAL_KEYBOARD_CELL_CACHE_WIDTH * GUI_VIRTUAL_KEYBOARD_CELL_CACHE_HEIGHT * 32) >> 3)
#else
#define GUI_VIRTUAL_KEYBOARD_CELL_CACHE_SIZE        ((GUI_VIRTUAL_KEYBOARD_CELL_CACHE_WIDTH * GUI_VIRTUAL_KEYBOARD_CELL_CACHE_HEIGHT * MMI_MAIN_BASE_LAYER_BITS_PER_PIXEL) >> 3)
#endif

#ifdef __MMI_VK_POPUP_HINT__
    #ifdef __MMI_VK_LONGTAP_POPUP_HINT__
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH     (GDI_LCD_WIDTH)
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT    (GDI_LCD_HEIGHT / 4)
        #define GUI_VIRTUAL_KEYBOARD_LONGTAP_POPUP_X_GAP 3
        #define GUI_VIRTUAL_KEYBOARD_LONGTAP_POPUP_Y_GAP 3
    #else
    #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH     (GDI_LCD_WIDTH / 4)
    #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT    (GDI_LCD_HEIGHT / 4)
    #endif /* __MMI_VK_LONGTAP_POPUP_HINT__ */
    
#if defined(__MMI_VUI_ENGINE__)
    #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_SIZE      ((GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH * GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT * 32) >> 3)
#else
    #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_SIZE      ((GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH * GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT * MMI_MAIN_BASE_LAYER_BITS_PER_PIXEL) >> 3)
#endif

    #if defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__)
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_Y_OFFSET     10
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_X_OFFSET     10
    #elif defined(__MMI_MAINLCD_320X480__) || defined(__MMI_MAINLCD_480X800__)
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_Y_OFFSET     11
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_X_OFFSET     24
    #else
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_Y_OFFSET     11
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_X_OFFSET     15
    #endif
#endif /* __MMI_VK_POPUP_HINT__ */
/***************************************************************************** 
* Typedef 
*****************************************************************************/
/* <group dom_virtual_keyboard_enum> */
typedef enum
{
    GUI_VIRTUAL_KEYBOARD_TEXT_ALIGN_CENTER = 0,
    GUI_VIRTUAL_KEYBOARD_TEXT_ALIGN_LEFT,
    GUI_VIRTUAL_KEYBOARD_TEXT_ALIGN_RIGHT,
    GUI_VIRTUAL_KEYBOARD_ICON_TEXT_HORIZONTAL_ALIGN,
    GUI_VIRTUAL_KEYBOARD_ICON_TEXT_VERTICAL_ALIGN,
    GUI_VIRTUAL_KEYBOARD_ALIGN_END
} gui_virtual_keyboard_text_align_enum;

/* <group dom_virtual_keyboard_enum> */
typedef enum
{
    GUI_VK_KEY_STATE_NONE,
    GUI_VK_KEY_STATE_NORMAL,
    GUI_VK_KEY_STATE_HIGHLIGHT,
    GUI_VK_KEY_STATE_DISABLE,
    GUI_VK_KEY_STATE_POPUP
} gui_virtual_keyboard_key_state_enum;

/* <group dom_virtual_keyboard_enum> */
typedef enum
{
    GUI_VIRTUAL_KEYBOARD_DISPLAY_CALLBACK_START,
    GUI_VIRTUAL_KEYBOARD_DISPLAY_CALLBACK_IMG,
    GUI_VIRTUAL_KEYBOARD_DISPLAY_CALLBACK_TEXT,
    GUI_VIRTUAL_KEYBOARD_DISPLAY_CALLBACK_IMG_TEXT,
    GUI_VIRTUAL_KEYBOARD_DISPLAY_CALLBACK_END
} gui_virtual_keyboard_display_callback_type_enum;

/* <group dom_virtual_keyboard_enum> */
typedef enum
{
    GUI_VIRTUAL_KEYBOARD_EVENT_START = 0,
    GUI_VIRTUAL_KEYBOARD_EVENT_KEEP_DOWN_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_CLEAR_DOWN_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_MULTITAP_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_ONLY_LONGTAP_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_END
} gui_virtual_keyboard_event_enum;


typedef void (*gui_virtual_keyboard_display_callback_func_ptr)(U32 pen_symbol, gui_virtual_keyboard_display_callback_type_enum *flag, PU8 *text,  PU8 *image, gui_virtual_keyboard_key_state_enum key_state);
typedef gui_virtual_keyboard_event_enum (*gui_virtual_keyboard_event_callback_func_ptr)(gui_virtual_keyboard_pen_enum key_event, S32 key_param, U32 ret);

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /*
     * content of key, it may be a char or an unicode or an enum.
     * char or unicode will be put in the low 16 bit of U32,
     * enum will be put in the high 16 bit of U32
     */
    U32 content;
    /* image id of key's content image in normal state */
    U16 content_id;
    /* image id of key¡¯s content of highlight status */
    U16 content_highlight_id;
    U16 content_disable_id;
    /* image id of key's normal background */
    U16 bg_id;
    /* image id of key's highlight background */
    U16 highlight_id;
    /* image id of key's disable background */
    U16 disable_id;
    /* position and dimension of key */
    U16 x;
    S16 y; /* negative y means the key is a popup key */
    U16 width;
    U16 height;
    S16 popup_index;
    kal_int8 font_size;
    kal_int8 text_offset_x, text_offset_y;
} gui_virtual_keyboard_key_struct, *gui_virtual_keyboard_key_struct_p;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* text align type in a key */
    gui_virtual_keyboard_text_align_enum text_align;
    /* is round rect if we use code to draw buttons */
    MMI_BOOL is_round_rect;
} gui_virtual_keyboard_key_attribute;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* 
     * If `allowed_characters' is not NULL, the parameters `disabled_chars' and `disabled_symbols'
     * will be ignored. 
     * 
     * It only enables characters listed in `allowed_characters'
     * and special pen event keys: GUI_VKBD_PEN_HIDE, GUI_VKBD_PEN_SHOW,
     *                             GUI_VKBD_PEN_CAPSLOCK, GUI_VKBD_PEN_SYMBPICKER
     *                             GUI_VKBD_PEN_DISPLAY_CALLBACK
     *
     * pen event keys GUI_VKBD_PEN_NEWLINE and GUI_VKBD_PEN_SPACE are enabled 
     * if '\n' and ' ' are listed. 
     *
     * `allowed_characters' may contain "-" for consecutive characters
     * (Ex. "a-z" for characters from a to z.)
     * If we want to accept "-", please write it as "\-" 
     * For example, "\-0-9." represents "-0123456789."
     */
    const UI_character_type *allowed_chars;

    /* Null-terminated list for disabled characters */
    UI_character_type disabled_chars[GUI_VIRTUAL_KEYBOARD_MAX_DISABLED_KEYS + 1];
    /* Terminated with GUI_VKBD_PEN_NONE */
    gui_virtual_keyboard_pen_enum disabled_symbols[GUI_VIRTUAL_KEYBOARD_MAX_DISABLED_KEYS + 1];
} gui_virtual_keyboard_disable_key_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* count of dead keys */
    U16 count;
    U16 index[GUI_VIRTUAL_KEYBOARD_MAX_DEAD_KEYS];
} gui_virtual_keyboard_dead_key_struct;

/* <group dom_virtual_keyboard_struct> */
 /* display area is an area for pinyin or bopomo input method to show candidate */
typedef struct
{
    S16 index;
    UI_character_type text[GUI_VIRTUAL_KEYBOARD_MAX_DISPLAY_AREA_TEXT_LEN + 1];
} gui_virtual_keyboard_display_area_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* index of key in key list */
    S16 index;
    /* physical coordinates of selected key */
    S16 x;
    S16 y;
    S16 width;
    S16 height;
    /*
     * this flag used to record whether selected key's be cached
     * and selected key's highlight effect displayed
     */
    MMI_BOOL is_key_cached;
    gdi_image_cache_bmp_struct key_bitmap;
} gui_virtual_keyboard_selected_key_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    U32 key_value; /* input */
    S16 x, y; /* output */
    S16 width, height; /* output */
} gui_virtual_keyboard_key_pos_info_struct, *gui_virtual_keyboard_key_pos_info_struct_p;


#define VK_LONGTAP_POPUP_MAX_CHAR 20
#define VK_LONGTAP_POPUP_MAX_ROWS 3

#ifdef __MMI_VK_LONGTAP_POPUP_HINT__
/* <group dom_virtual_keyboard_struct> */
typedef struct{
	S16 x;
	S16 y;
} gui_virtual_keyboard_image_cordinate_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    S16 num;
    S16 rows;
    S16 chars_per_row;
    gui_virtual_keyboard_image_cordinate_struct image_cordinate[VK_LONGTAP_POPUP_MAX_CHAR];
    S16 key_index_array[VK_LONGTAP_POPUP_MAX_CHAR];
    S16 image_width;
    S16 image_height;
    S16 highlighted_index;
    S16 x,y, width, height;
    S16 key_index;
    gdi_image_cache_bmp_struct key_bitmap;
} gui_virtual_keyboard_longtap_popup_hint_struct;

#endif /* __MMI_VK_LONGTAP_POPUP_HINT__ */

#ifdef __MMI_VK_POPUP_HINT__
/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* physical coordinates of popup hint */
    S16 x;
    S16 y;
    S16 width;
    S16 height;
    /* physical coordinates of character's position */
    S16 char_x;
    S16 char_y;
    PU8 popup_background;
    gui_virtual_keyboard_event_enum popup_state;
    U32 multitap_event;
#ifdef __MMI_VK_LONGTAP_POPUP_HINT__
    gui_virtual_keyboard_longtap_popup_hint_struct longtap_hint_details;
#endif /* __MMI_VK_LONGTAP_POPUP_HINT__ */
    /* 
     * this flag used to record whether image be cached before show popup hint
     * and popup hint be displayed
     */
    MMI_BOOL is_key_cached;
    gdi_image_cache_bmp_struct key_bitmap;
    MMI_BOOL is_cursor_stop;
    MMI_BOOL (*hide_cursor_callback) (S32 x1, S32 y1, S32 x2, S32 y2);
    void (*blink_cursor_callback) (void);
} gui_virtual_keyboard_popup_hint_struct;
#endif /* __MMI_VK_POPUP_HINT__ */

/* <group dom_virtual_keyboard_struct>
 * kept key is for the aim of keep some keys, such as dead key or shift key,
 * these key need to keep the down state until other key be pressed, but in 
 * such situation, we only permit one key kept down state 
 */
typedef struct
{
    MMI_BOOL is_down_kept;
    S16 index;
} gui_virtual_keyboard_kept_down_key_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct
{
    /* position of virtual keyboard */
    S32 x, y;
    /* dimension of virtual keyboard */
    S32 width, height;
    /* flag of virtual keyboard to descript vk's state */
    U32 flags;
    /* attribute of virtual keyboard*/
    U32 vk_attr;
    /* key count of virtual keyboard */
    U16 key_count;
    /* image background of virtual keyboard */
    U16 bg_id;
    /* theme of virtual keyboard */
    UI_virtual_keyboard_theme *theme;

    /* key attribute of the virtual keyboard */
    gui_virtual_keyboard_key_attribute key_attribute;
    /* key list */
    gui_virtual_keyboard_key_struct_p key_list;

    /* pen event handled by virtual keyboard */
    MMI_BOOL key_down_accepted;
    /* key that selected by pen */
    gui_virtual_keyboard_selected_key_struct selected_key;
#ifdef __MMI_VK_POPUP_HINT__
    /* popup hint of the selected key */
    gui_virtual_keyboard_popup_hint_struct popup_hint;
    #ifdef __MMI_VK_LONGTAP_POPUP_HINT__
    /* longtap pop-up state */
    MMI_BOOL longtap_popup_state;
    #endif /* __MMI_VK_LONGTAP_POPUP_HINT__ */
#endif
    /* disable key list */
    gui_virtual_keyboard_disable_key_struct disable_keys;
    /* dead key list */
    gui_virtual_keyboard_dead_key_struct dead_keys;
    /* kept down key */
    gui_virtual_keyboard_kept_down_key_struct kept_key;
    /* display area's text */
    gui_virtual_keyboard_display_area_struct display_area;

    /*hide function, provide for category to fill it's wanted background*/
    void (*hide_callback) (S32 x1, S32 y1, S32 x2, S32 y2);
    /* virtual keyboard display callback used to get key's info dynamiclly */
    gui_virtual_keyboard_display_callback_func_ptr display_callback;
    gui_virtual_keyboard_event_callback_func_ptr event_callback;
#if defined(__MMI_VUI_ENGINE__)
    MMI_BOOL is_venus_vk;
#endif
} gui_virtual_keyboard_struct;

typedef gui_virtual_keyboard_struct* (*gui_virtual_keyboard_get_vk_callback_func_ptr)(void);

/***************************************************************************** 
* Extern Global Variable
*****************************************************************************/
/* <group dom_virtual_keyboard_variables> */
extern UI_virtual_keyboard_theme *current_virtual_keyboard_theme;


/***************************************************************************** 
* Extern Global Function
*****************************************************************************/
extern MMI_BOOL gui_virtual_keyboard_get_long_tap_popup_state(
                    gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_discard_cache_and_recache(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_draw_from_cache(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_recache(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_register_get_vk_callback(
      gui_virtual_keyboard_get_vk_callback_func_ptr f);
extern void gui_virtual_keyboard_set_flags_on(
             gui_virtual_keyboard_struct *v,
             U32 flag);
extern void gui_virtual_keyboard_set_flags_off(
             gui_virtual_keyboard_struct *v,
             U32 flag);

extern void gui_virtual_keyboard_create(
             gui_virtual_keyboard_struct *v,
             S32 x,
             S32 y,
             S32 width,
             S32 height,
             U16 key_count,
             gui_virtual_keyboard_key_struct_p key_list,
             MMI_BOOL is_venus);
extern void gui_virtual_keyboard_close(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_move(
             gui_virtual_keyboard_struct *v,
             S32 x,
             S32 y);
extern void gui_virtual_keyboard_show(gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_set_theme(
             gui_virtual_keyboard_struct *v,
             UI_virtual_keyboard_theme *t);
extern void gui_virtual_keyboard_set_current_theme(gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_set_bg(gui_virtual_keyboard_struct *v, U16 bg_id);
extern void gui_virtual_keyboard_set_key_attribute(
             gui_virtual_keyboard_struct *v,
             gui_virtual_keyboard_key_attribute key_attribute);

extern void gui_virtual_keyboard_set_dead_keys(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *dead_chars);
extern void gui_virtual_keyboard_set_allowed_characters(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *allowed_chars);
extern void gui_virtual_keyboard_set_disable_list(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *disabled_chars,
             const gui_virtual_keyboard_pen_enum *disabled_symbols);
extern void gui_virtual_keyboard_set_display_area(
             gui_virtual_keyboard_struct *v,
             const U8 *string,
             MMI_BOOL redraw);

extern void gui_virtual_keyboard_register_hide_callback(
             gui_virtual_keyboard_struct *v,
             void (*f) (S32 x1, S32 y1, S32 x2, S32 y2));
extern void gui_virtual_keyboard_register_display_callback(
             gui_virtual_keyboard_struct *v,
             gui_virtual_keyboard_display_callback_func_ptr f);
extern void gui_virtual_keyboard_register_event_callback(
             gui_virtual_keyboard_struct *v,
             gui_virtual_keyboard_event_callback_func_ptr f);
extern MMI_BOOL gui_virtual_keyboard_translate_pen_event(
                 gui_virtual_keyboard_struct *v,
                 S16 x,
                 S16 y,
                 mmi_pen_event_type_enum pen_event,
                 gui_virtual_keyboard_pen_enum *key_event,
                 gui_pen_event_param_struct *key_param);
extern MMI_BOOL gui_virtual_keyboard_get_current_character(
                 gui_virtual_keyboard_struct *v,
                 S16 x,
                 S16 y,
                 UI_character_type *ch);
extern void gui_virtual_keyboard_set_disable_list(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *disabled_chars,
             const gui_virtual_keyboard_pen_enum *disabled_symbols);
extern void gui_virtual_keyboard_set_theme(
             gui_virtual_keyboard_struct *v,
             UI_virtual_keyboard_theme *t);
extern void gui_virtual_keyboard_set_current_theme(
             gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_get_key_info(gui_virtual_keyboard_struct *v, gui_virtual_keyboard_key_pos_info_struct_p info);


#ifdef __MMI_VK_POPUP_HINT__
extern void gui_virtual_keyboard_register_hide_cursor_callback(
             gui_virtual_keyboard_struct *v,
             MMI_BOOL (*f) (S32 x1, S32 y1, S32 x2, S32 y2));
extern void gui_virtual_keyboard_register_blink_cursor_callback(
             gui_virtual_keyboard_struct *v,
             void (*f) (void));
extern void gui_virtual_keyboard_recover_covered_area(
             gui_virtual_keyboard_struct *v);
extern   void gui_virtual_keyboard_show_popup(gui_virtual_keyboard_struct* v, MMI_BOOL cache);

#endif /* __MMI_VK_POPUP_HINT__ */

extern MMI_BOOL gui_virtual_keyboard_Check_alphanumeric_vk_0_to_9_key(
          gui_virtual_keyboard_struct *v,
          S16 x,
          S16 y);

#endif /* __MMI_TOUCH_SCREEN__ */

extern void gui_virtual_keyboard_clear_cache_on_imc_disconnect(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_clear_state_on_imc_disconnect(gui_virtual_keyboard_struct *v);

#endif /* __MMI_UI_VIRTUAL_KEYBOARD_DEFAULT_VERSION_2__ */

#if defined(__MMI_UI_VIRTUAL_KEYBOARD_DEFAULT_VERSION_3__)
#include "MMIDataType.h"
#include "gui_data_types.h"
#include "gdi_include.h"
#include "gui_theme_struct.h"
#include "wgui.h"
#include "gui_virtual_keyboard_language_type.h"
typedef UI_string_type (*get_multitap_string)(S32 i);


#if defined(__MMI_TOUCH_SCREEN__)

#define VK_IS_ACTIVE_STATE 1
#define VK_SHIFT_STATE_NONE (1 << 1)
#define VK_SHIFT_STATE_LOWER (1 << 2)
#define VK_SHIFT_STATE_UP_ONCE (1 << 3)
#define VK_SHIFT_STATE_UP_STABLE (1 << 4)
#define VK_POPUP_HINT
#define VK_LONG_TAP_POP_UP_HINT

#if defined(__MMI_VECTOR_FONT_SUPPORT__)
#define VKBD_DIFF_HALF(a, b)  ((a) >= (b) ? (((a) - (b)) - (((a)-(b)) >> 1)) : 0)
#else
#define VKBD_DIFF_HALF(a, b)  ((a) >= (b) ? (((a)-(b)) >> 1) : 0)
#endif /* __MMI_VECTOR_FONT_SUPPORT__ */

#define GUI_VIRTUAL_KEYBOARD_MAX_DISPLAY_AREA_TEXT_LEN      11
#define MMI_VKBD_MAX_DISPLAY_AREA_TEXT_LEN                  GUI_VIRTUAL_KEYBOARD_MAX_DISPLAY_AREA_TEXT_LEN

//To do: we'd better move this width to oem layer
#define GUI_VIRTUAL_KEYBOARD_KEY_FRAME_WIDTH                1

#define GUI_VIRTUAL_KEYBOARD_MAX_DISABLED_KEYS              20
#define GUI_VIRTUAL_KEYBOARD_MAX_DEAD_KEYS                  8

#define GUI_VIRTUAL_KEYBOARD_STATE_CLOSE                    0x00000000
#define GUI_VIRTUAL_KEYBOARD_STATE_ACTIVE                   0x00000001
#define GUI_VIRTUAL_KEYBOARD_STATE_HIDE                     0x00000002
#define GUI_VIRTUAL_KEYBOARD_STATE_MULTI_BLOCK              0x00000010
#define GUI_VIRTUAL_KEYBOARD_DRAW_KEY_BY_IMAGE              0x00000020
#define GUI_VIRTUAL_KEYBOARD_LARGE_PANEL_HANDWRITING        0x00000100

#define GUI_VIRTUAL_KEYBOARD_INVALID_KEY_INDEX              -1

#define GUI_VIRTUAL_KEYBOARD_CONTENT_BORDER_GAP             2
#define GUI_VIRTUAL_KEYBOARD_CONTENT_ITEM_GAP               2

#define GUI_VIRTUAL_KEYBOARD_GRADIENT_ALPHA_PERCENT         30

#define GUI_VIRTUAL_KEYBOARD_CELL_CACHE_WIDTH       (GDI_LCD_WIDTH / 2)
#define GUI_VIRTUAL_KEYBOARD_CELL_CACHE_HEIGHT      (GDI_LCD_HEIGHT / 8)

#ifdef __MMI_VK_POPUP_HINT__
    #ifdef __MMI_VK_LONGTAP_POPUP_HINT__
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH     (GDI_LCD_WIDTH)
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT    (GDI_LCD_HEIGHT / 4)
        #define GUI_VIRTUAL_KEYBOARD_LONGTAP_POPUP_X_GAP 3
        #define GUI_VIRTUAL_KEYBOARD_LONGTAP_POPUP_Y_GAP 3
    #else
    #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH     (GDI_LCD_WIDTH / 4)
    #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT    (GDI_LCD_HEIGHT / 4)
    #endif /* __MMI_VK_LONGTAP_POPUP_HINT__ */
    
#define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_SIZE      ((GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_WIDTH * GUI_VIRTUAL_KEYBOARD_POPUP_HINT_CACHE_HEIGHT * MMI_MAIN_BASE_LAYER_BITS_PER_PIXEL) >> 3)


    #if defined(__MMI_MAINLCD_240X320__) || defined(__MMI_MAINLCD_240X400__)
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_Y_OFFSET     10
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_X_OFFSET     10
    #elif defined(__MMI_MAINLCD_320X480__) || defined(__MMI_MAINLCD_480X800__)
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_Y_OFFSET     11
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_X_OFFSET     24
    #else
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_Y_OFFSET     11
        #define GUI_VIRTUAL_KEYBOARD_POPUP_HINT_ARROW_X_OFFSET     15
    #endif
#endif /* __MMI_VK_POPUP_HINT__ */

#define GUI_VIRTUAL_KEYBOARD_ALPHANUMERIC_KEY_MAIN_LABEL_BIAOS_X (-0.3 / 2)
#define GUI_VIRTUAL_KEYBOARD_ALPHANUMERIC_KEY_MAIN_LABEL_BIAOS_y (-0.1 / 2)
#define GUI_VIRTUAL_KEYBOARD_ALPHANUMERIC_KEY_AUX_LABEL_BIAOS_X (0 / 2)
#define GUI_VIRTUAL_KEYBOARD_ALPHANUMERIC_KEY_AUX_LABEL_BIAOS_Y (0.3 / 2)

struct gui_virtual_keyboard_togglekey_struct;
struct gui_virtual_keyboard_key_struct;
struct wgui_virtual_keyboard_layout_struct;
struct gui_virtual_keyboard_keytype_struct;
struct gui_virtual_keyboard_key_struct;
struct gui_virtual_keyboard_row_struct;
struct gui_virtual_keyboard_struct;

typedef enum
{
    GUI_VK_KEY_STATE_NONE,
    GUI_VK_KEY_STATE_DISABLE,
    GUI_VK_KEY_STATE_NORMAL,
    GUI_VK_KEY_STATE_HIGHLIGHT,
    GUI_VK_KEY_STATE_POPUP,
    GUI_VK_KEY_STATE_LONGTAP_POPUP
} gui_virtual_keyboard_key_state_enum;

typedef enum
{
    GUI_VIRTUAL_KEYBOARD_EVENT_START = 0,
    GUI_VIRTUAL_KEYBOARD_EVENT_KEEP_DOWN_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_CLEAR_DOWN_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_MULTITAP_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_ONLY_LONGTAP_STATE,
    GUI_VIRTUAL_KEYBOARD_EVENT_END
} gui_virtual_keyboard_event_enum;

typedef enum
{
    GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_START,
    GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_SHIFT = GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_START,
    GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_ENTER,
    GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_SMART_MULTITAP,
    GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_SYMBOL_PICKER,
    GUI_VIRTUAL_KEYBOARD_MULTI_STYLE_KEY,
    GUI_VIRTUAL_KEYBOARD_PHONENUMBER_VK_MULTI_STYLE,
    GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_MULTI_STYLE,
    GUI_VIRTUAL_KEYBOARD_SYMBOL_VK_MULTI_STYLE,
    GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_SYMBOL_STYLE,

    GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_END
} toggle_state_key_index_enum;

typedef enum
{
    //GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_ENTER
    GUI_VIRTUAL_KEYBOARD_ENTER_KEY_ENTER = 0,
    GUI_VIRTUAL_KEYBOARD_ENTER_KEY_GO = 2,//value from xml
    GUI_VIRTUAL_KEYBOARD_ENTER_KEY_SEARCH = 5,
    GUI_VIRTUAL_KEYBOARD_ENTER_KEY_DONE = 6,

    //GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_SHIFT
    GUI_VIRTUAL_KEYBOARD_SHIFT_KEY_LOWER = 0,
    GUI_VIRTUAL_KEYBOARD_SHIFT_KEY_UP_ONCE = 10,
    GUI_VIRTUAL_KEYBOARD_SHIFT_KEY_UP_STABLE = 11,

    // GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_SMART_MULTITAP
    GUI_VIRTUAL_KEYBOARD_NO_SMART = 0,
    GUI_VIRTUAL_KEYBOARD_SMART_ENABLE = 12,
    GUI_VIRTUAL_KEYBOARD_SMART_DISABLE = 13,
    
    // GUI_VIRTUAL_KEYBOARD_MULTI_STYLE_KEY
    GUI_VIRTUAL_KEYBOARD_MULTI_STYLE_NONE = 0,
    GUI_VIRTUAL_KEYBOARD_MULTI_STYLE_EMAIL = 20,
    GUI_VIRTUAL_KEYBOARD_MULTI_STYLE_INTERNET = 21,
    
    //GUI_VIRTUAL_KEYBOARD_PHONENUMBER_VK_MULTI_STYLE
    GUI_VIRTUAL_KEYBOARD_PHONENUMBER_VK_MULTI_STYLE_NONE = 0,
    GUI_VIRTUAL_KEYBOARD_PHONENUMBER_VK_MULTI_STYLE_NUMBER_ONLY = 7,

    //GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_MULTI_STYLE
    GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_MULTI_STYLE_NONE = 0,
    GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_MULTI_STYLE_HW_ONLY = 8,

    //GUI_VIRTUAL_KEYBOARD_SYMBOL_VK_MULTI_STYLE
    GUI_VIRTUAL_KEYBOARD_SYMBOL_VK_MULTI_STYLE_NONE = 0,
    GUI_VIRTUAL_KEYBOARD_SYMBOL_VK_MULTI_STYLE_ALPHA_ONLY = 9,

    //GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_SYMBOL_STYLE
    GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_SYMBOL_STYLE_ALPHABETIC = 0,
    GUI_VIRTUAL_KEYBOARD_HANDWRITING_VK_SYMBOL_STYLE_CHINESE = 14,

	//GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_SYMBOL_PICKER
	GUI_VIRTUAL_KEYBOARD_SYMBOL_PICKER_STYLE_NONE = 0,
	GUI_VIRTUAL_KEYBOARD_SYMBOL_PICKER_STYLE_123SYM = 1,
    
    GUI_VIRTUAL_KEYBOARD_KEY_END
}toggle_state_id_mapping_enum;

typedef struct
{
    U32 key_value; /* input */
    S16 x, y; /* output */
    S16 width, height; /* output */
} gui_virtual_keyboard_key_pos_info_struct, *gui_virtual_keyboard_key_pos_info_struct_p;

typedef struct
{
    U16 x,y;
    U16 width, height;
}gui_virtual_keyboard_rect_struct,*gui_virtual_keyboard_rect_struct_p;
typedef color vk_color;
typedef struct
{
    UI_string_type label;
    U32 color;
    vk_color fomat_color;
    U8 size;
    S16 bias_loc_x, bias_loc_y;
    U16 label_icon;
}gui_virtual_keyboard_key_label_info_struct, *gui_virtual_keyboard_key_label_info_struct_p;

typedef struct gui_virtual_keyboard_keytype_struct
{
    U16 bg; //background image for key;
    U16 hlbg;   //hight light background image for key;
    U16 balloonbg;  //popup key's background
    
    float balloon_height_ratio; //popup key's height
    float balloon_width_ratio;  //popup key's width

    U32 text1_color;    //text color of key's main label
    U32 text2_color;    //text color of key's aux label
    U32 hl_text1_color; //hight light text color of key's main label
    U32 hl_text2_color; //hight light text color of key's aux label
    U32 bl_text1_color; //text color of popup key's main label
    U32 bl_text2_color; //text color of popup key's aux label

    S16 text1_loc_biasx;    //location of key's main label
    S16 text1_loc_biasy;    //location of key's main label
    S16 text2_loc_biasx;    //location of key's aux label
    S16 text2_loc_biasy;    //location of key's aux label

    U8 text1_size;  //font size of key's main label
    U8 text2_size;  //font size of key's aux label
    U8 hltext1_size;    //hight light font size of key's main label
    U8 hltext2_size;    //hight light font size of key's aux label
    U8 bltext1_size;    //popup font size of key's main label
    U8 bltext2_size;    //popup font size of key's aux label
}gui_virtual_keyboard_keytype_struct,*gui_virtual_keyboard_keytype_struct_p;


typedef struct gui_virtual_keyboard_key_struct
{
    U32 code; //unicode for key if key is normal key

    U8 keytype; //key type index in template(keytype_list)

    U16 lable_icon; //icon for key's foreground
    U16 lable_icon_aux; //icon for key's aux foreground
    U16 lable_icon_hl;
    U16 lable_icon_aux_hl;

    UI_string_type label_string; //string for key's foreground    (if label_string is not null, label_icon will not be used)
    UI_string_type label_string_aux;

    UI_string_type label_balloon_string;
    U16 label_balloon_icon;

    U32 code_long_press;    //longpress code for key
    UI_string_type lable_balloon_longpress; //lablel in longpress popup
    U16 label_balloon_longpress_icon; //icon in longpress popup

    U16 pos_x;  //key's position
    U16 pos_y;
    U8 height;
    U8 width;

    const struct wgui_virtual_keyboard_layout_struct * popup_vk;  //longpress popup vk
    const struct gui_virtual_keyboard_togglekey_struct * toggle_state;
}gui_virtual_keyboard_key_struct,*gui_virtual_keyboard_key_struct_p;

typedef struct gui_virtual_keyboard_togglekey_struct
{
    U8 state_num;
    const U8* state_id_list;
    const struct gui_virtual_keyboard_key_struct** toggle_state_key_list;
}gui_virtual_keyboard_togglekey_struct, *gui_virtual_keyboard_togglekey_struct_p;

typedef struct gui_virtual_keyboard_row_struct
{
    S16 row_id;
    U8 key_count;
    const struct gui_virtual_keyboard_key_struct* key_list;
}gui_virtual_keyboard_row_struct, *gui_virtual_keyboard_row_struct_p;

typedef struct gui_virtual_keyboard_disable_key_struct
{
    /* 
     * If `allowed_characters' is not NULL, the parameters `disabled_chars' and `disabled_symbols'
     * will be ignored. 
     * 
     * It only enables characters listed in `allowed_characters'
     * and special pen event keys: GUI_VKBD_PEN_HIDE, GUI_VKBD_PEN_SHOW,
     *                             GUI_VKBD_PEN_CAPSLOCK, GUI_VKBD_PEN_SYMBPICKER
     *                             GUI_VKBD_PEN_DISPLAY_CALLBACK
     *
     * pen event keys GUI_VKBD_PEN_NEWLINE and GUI_VKBD_PEN_SPACE are enabled 
     * if '\n' and ' ' are listed. 
     *
     * `allowed_characters' may contain "-" for consecutive characters
     * (Ex. "a-z" for characters from a to z.)
     * If we want to accept "-", please write it as "\-" 
     * For example, "\-0-9." represents "-0123456789."
     */
    const UI_character_type *allowed_chars;

    /* Null-terminated list for disabled characters */
    UI_character_type disabled_chars[GUI_VIRTUAL_KEYBOARD_MAX_DISABLED_KEYS + 1];
    /* Terminated with GUI_VKBD_PEN_NONE */
    gui_virtual_keyboard_pen_enum disabled_symbols[GUI_VIRTUAL_KEYBOARD_MAX_DISABLED_KEYS + 1];
} gui_virtual_keyboard_disable_key_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct gui_virtual_keyboard_dead_key_struct
{
    /* count of dead keys */
    U16 count;
    const gui_virtual_keyboard_key_struct* index[GUI_VIRTUAL_KEYBOARD_MAX_DEAD_KEYS];
} gui_virtual_keyboard_dead_key_struct;

/* <group dom_virtual_keyboard_struct> */
 /* display area is an area for pinyin or bopomo input method to show candidate */
typedef struct gui_virtual_keyboard_display_area_struct
{
    S16 index;
    UI_character_type text[GUI_VIRTUAL_KEYBOARD_MAX_DISPLAY_AREA_TEXT_LEN + 1];
} gui_virtual_keyboard_display_area_struct;

/* <group dom_virtual_keyboard_struct> */
typedef struct gui_virtual_keyboard_selected_key_struct
{
    /* index of key in key list */
    const gui_virtual_keyboard_key_struct* index;
    /* physical coordinates of selected key */
    S16 x;
    S16 y;
    S16 width;
    S16 height;
    /*
     * this flag used to record whether selected key's be cached
     * and selected key's highlight effect displayed
     */
    MMI_BOOL is_key_cached;
    gdi_image_cache_bmp_struct key_bitmap;
} gui_virtual_keyboard_selected_key_struct;

/* <group dom_virtual_keyboard_struct> */

#define VK_LONGTAP_POPUP_MAX_CHAR 20
#define VK_LONGTAP_POPUP_MAX_ROWS 3


#ifdef __MMI_VK_POPUP_HINT__
/* <group dom_virtual_keyboard_struct> */
typedef struct gui_virtual_keyboard_popup_hint_struct
{
    /* physical coordinates of popup hint */
    S16 x;
    S16 y;
    S16 width;
    S16 height;

    U8 popup_state;
    
    /* 
     * this flag used to record whether image be cached before show popup hint
     * and popup hint be displayed
     */
    MMI_BOOL is_key_cached;
    gdi_image_cache_bmp_struct key_bitmap;
} gui_virtual_keyboard_popup_hint_struct;
#endif /* __MMI_VK_POPUP_HINT__ */

typedef void (*gui_virtual_keyboard_display_callback_func_ptr)(U32 pen_symbol);
typedef U8 (*gui_virtual_keyboard_event_callback_func_ptr)(gui_virtual_keyboard_pen_enum key_event, S32 key_param, U32 ret);

typedef struct gui_virtual_keyboard_struct
{
    U16 width;  //width of VK
    U16 height; //width of VK
    U16 x;  //pos of VK
    U16 y;  //pos of VK

    U16 margin_x;
    U16 margin_y;
    
    U16 bg_id;
    
    U16 row_num;//total num of keyboard.


    const struct gui_virtual_keyboard_row_struct* row_list;

    /* pen event handled by virtual keyboard */
    MMI_BOOL key_down_accepted;
    /* key that selected by pen */
    gui_virtual_keyboard_selected_key_struct selected_key;

    const struct gui_virtual_keyboard_keytype_struct* keytype_list;

    #ifdef __MMI_VK_LONGTAP_POPUP_HINT__
        MMI_BOOL is_mini_keyboard_state;
        void * popup_vk_layout_p;   //this is for pop up virtual keyboard
        void * vk_layout_backup;    //this is for resume the virtual keyboard
        const gui_virtual_keyboard_key_struct* popup_key;
        gdi_image_cache_bmp_struct mini_keyboard_bitmap;
    #endif

//above this line, all attribute was share in normal keyboard & mini keyboards.

    U8 active_row;
    U8 current_row_num;//num of active key on keyboard
    gui_virtual_keyboard_language_enum keyboard;
    U32 flag;
    U32 vk_attribute;   //indicate VK's style, for example ,qwerty,  phonetic and handwriting.
    MMI_BOOL is_rotate; //indicate whether VK is land mode.

    #ifdef __MMI_VK_POPUP_HINT__
        gui_virtual_keyboard_popup_hint_struct popup_hint;
    #endif /* __MMI_VK_POPUP_HINT__ */
    
    MMI_BOOL is_shift_support;
    U8 toggle_state_ids[GUI_VIRTUAL_KEYBOARD_TOGGLE_KEY_END];

    UI_virtual_keyboard_theme *theme;

    gui_virtual_keyboard_disable_key_struct disable_keys;
    /* dead key list */
    gui_virtual_keyboard_dead_key_struct dead_keys;

    /*hide function, provide for category to fill it's wanted background*/
    void (*hide_callback) (S32 x1, S32 y1, S32 x2, S32 y2);
        
    MMI_BOOL is_cursor_stop;
    MMI_BOOL (*hide_cursor_callback) (S32 x1, S32 y1, S32 x2, S32 y2);
    void (*blink_cursor_callback) (void);

    UI_character_type string_buffer[40];
}gui_virtual_keyboard_struct, *gui_virtual_keyboard_struct_p;

extern UI_virtual_keyboard_theme *current_virtual_keyboard_theme;


typedef gui_virtual_keyboard_struct* (*gui_virtual_keyboard_get_vk_callback_func_ptr)(void);

extern void gui_virtual_keyboard_get_popup_vk_layout(
                 const gui_virtual_keyboard_key_struct* key,
                 void** layout_p);

extern void gui_virtual_keyboard_set_shift_state(
                gui_virtual_keyboard_struct* v,
                U32 flag);

extern void gui_virtual_keyboard_get_key_hint_rect(
    gui_virtual_keyboard_struct_p v,
    const gui_virtual_keyboard_key_struct* key,
    gui_virtual_keyboard_rect_struct_p rect);

extern void gui_virtual_keyboard_get_key_bg_img(
        gui_virtual_keyboard_struct_p v,
        const gui_virtual_keyboard_key_struct* key,
        PU16 img_id,
        gui_virtual_keyboard_key_state_enum state);

extern void gui_virtual_keyboard_get_key_rect(
        const gui_virtual_keyboard_key_struct* key,
        gui_virtual_keyboard_rect_struct_p rect);

extern void gui_virtual_keyboard_get_label_int(
        gui_virtual_keyboard_struct_p v,
        const gui_virtual_keyboard_key_struct* key,
        gui_virtual_keyboard_key_label_info_struct_p label,
        gui_virtual_keyboard_key_state_enum state,
        U32 index);

extern void gui_virtual_keyboard_translate_index_to_pointer(
        U32 index, 
        const gui_virtual_keyboard_key_struct** key);

extern MMI_BOOL gui_virtual_keyboard_get_long_tap_popup_state(
                    gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_discard_cache_and_recache_hint(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_draw_from_cache(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_recache(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_register_get_vk_callback(
      gui_virtual_keyboard_get_vk_callback_func_ptr f);
extern void gui_virtual_keyboard_set_flags_on(
             gui_virtual_keyboard_struct *v,
             U32 flag);
extern void gui_virtual_keyboard_set_flags_off(
             gui_virtual_keyboard_struct *v,
             U32 flag);

extern MMI_BOOL gui_virtual_keyboard_is_shift_support(
            gui_virtual_keyboard_struct* v);

extern void gui_virtual_keyboard_initilize(
            gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_create(
              void* layout,
              gui_virtual_keyboard_struct *v,
              S32 x,
              S32 y,
              S32 width,
              S32 height,
              U16 row_count,
              const gui_virtual_keyboard_row_struct* row_list,
              const gui_virtual_keyboard_keytype_struct* keytype_list,
              U16 margin_x,
              U16 margin_y);
extern void gui_virtual_keyboard_close(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_move(
             gui_virtual_keyboard_struct *v,
             S32 x,
             S32 y);
extern void gui_virtual_keyboard_show(gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_set_theme(
             gui_virtual_keyboard_struct *v,
             UI_virtual_keyboard_theme *t);
extern void gui_virtual_keyboard_set_current_theme(gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_set_bg(gui_virtual_keyboard_struct *v, U16 bg_id);

extern void gui_virtual_keyboard_set_dead_keys(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *dead_chars);
extern void gui_virtual_keyboard_set_allowed_characters(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *allowed_chars);
extern void gui_virtual_keyboard_set_disable_list(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *disabled_chars,
             const gui_virtual_keyboard_pen_enum *disabled_symbols);
extern void gui_virtual_keyboard_set_display_area(
             gui_virtual_keyboard_struct *v,
             const U8 *string,
             MMI_BOOL redraw);

extern void gui_virtual_keyboard_register_hide_callback(
             gui_virtual_keyboard_struct *v,
             void (*f) (S32 x1, S32 y1, S32 x2, S32 y2));
extern void gui_virtual_keyboard_register_display_callback(
             gui_virtual_keyboard_struct *v,
             gui_virtual_keyboard_display_callback_func_ptr f);
extern void gui_virtual_keyboard_register_event_callback(
             gui_virtual_keyboard_struct *v,
             gui_virtual_keyboard_event_callback_func_ptr f);
extern MMI_BOOL gui_virtual_keyboard_translate_pen_event(
                 gui_virtual_keyboard_struct *v,
                 S16 x,
                 S16 y,
                 mmi_pen_event_type_enum pen_event,
                 gui_virtual_keyboard_pen_enum *key_event,
                 gui_pen_event_param_struct *key_param);
extern MMI_BOOL gui_virtual_keyboard_get_current_character(
                 gui_virtual_keyboard_struct *v,
                 S16 x,
                 S16 y,
                 UI_character_type *ch);

extern MMI_BOOL gui_virtual_keyboard_is_shift_state(
                    gui_virtual_keyboard_struct* v);

extern MMI_BOOL gui_virtual_keyboard_add_toggle_state_key(
                toggle_state_key_index_enum toggle_key_index,
                toggle_state_id_mapping_enum state_id);

extern MMI_BOOL gui_virtual_keyboard_remove_toggle_state_key(
                toggle_state_key_index_enum toggle_key_index);

extern void gui_virtual_keyboard_set_disable_list(
             gui_virtual_keyboard_struct *v,
             const UI_character_type *disabled_chars,
             const gui_virtual_keyboard_pen_enum *disabled_symbols);
extern void gui_virtual_keyboard_set_theme(
             gui_virtual_keyboard_struct *v,
             UI_virtual_keyboard_theme *t);
extern void gui_virtual_keyboard_set_current_theme(
             gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_get_key_info(gui_virtual_keyboard_struct *v, gui_virtual_keyboard_key_pos_info_struct_p info);

extern void gui_virtual_keyboard_convert_up_low_form_shift_state(
            gui_virtual_keyboard_struct *v,
            const UI_string_type src,
            UI_string_type det);

extern U32 gui_virtual_keyboard_get_button_count(
    gui_virtual_keyboard_struct_p v);

extern MMI_BOOL gui_virtual_keyboard_is_rotate_vk(void);

extern MMI_BOOL gui_virtual_keyboard_is_cached(void);

    extern S32 gui_virtual_keyboard_get_button_code(  
        U32 index, mmi_pen_event_type_enum pen_event);

extern U32 gui_virtual_keyboard_get_button_type(U32 index, mmi_pen_event_type_enum pen_event);

#ifdef __MMI_VK_POPUP_HINT__
extern void gui_virtual_keyboard_register_hide_cursor_callback(
             gui_virtual_keyboard_struct *v,
             MMI_BOOL (*f) (S32 x1, S32 y1, S32 x2, S32 y2));
extern void gui_virtual_keyboard_register_blink_cursor_callback(
             gui_virtual_keyboard_struct *v,
             void (*f) (void));
extern void gui_virtual_keyboard_recover_covered_area(
             gui_virtual_keyboard_struct *v);

struct wgui_virtual_keyboard_layout_struct;
extern void wgui_virtual_keyboard_create_keyboard_from_layout(
            gui_virtual_keyboard_struct_p v,
            const struct wgui_virtual_keyboard_layout_struct * layout);

#endif /* __MMI_VK_POPUP_HINT__ */

extern U32 gui_virtual_keyboard_return_floating_composition_box_width(void);

extern MMI_BOOL gui_virtual_keyboard_Check_alphanumeric_vk_0_to_9_key(
          gui_virtual_keyboard_struct *v,
          S16 x,
          S16 y);

extern void gui_virtual_keyboard_set_active_row(gui_virtual_keyboard_struct* v,S16 row_id);

extern void gui_virtual_keyboard_set_long_tap_popup_deactive(
                gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_set_long_tap_popup_active(
                gui_virtual_keyboard_struct *v);

extern void gui_virtual_keyboard_set_get_string_func(get_multitap_string f);

extern MMI_BOOL gui_virtual_keyboard_is_symbol_vk(gui_virtual_keyboard_language_enum vk_type);

extern MMI_BOOL gui_virtual_keyboard_is_alphanumeric_vk(void);

extern U32 gui_virtual_keyboard_get_vk_width(void);
extern U32 gui_virtual_keyboard_get_vk_height(void);

extern void gui_virtual_keyboard_get_key_main_label(
        gui_virtual_keyboard_struct_p v,
        const gui_virtual_keyboard_key_struct* key,
        gui_virtual_keyboard_key_label_info_struct_p label,
        gui_virtual_keyboard_key_state_enum state);

void gui_virtual_keyboard_get_key_aux_label(
        gui_virtual_keyboard_struct_p v,
        const gui_virtual_keyboard_key_struct* key,
        gui_virtual_keyboard_key_label_info_struct_p label,
        gui_virtual_keyboard_key_state_enum state);

extern MMI_BOOL gui_virtual_keyboard_is_popup_can_be_shown(
		gui_virtual_keyboard_struct *v,
		const gui_virtual_keyboard_key_struct *key);


#endif /* __MMI_TOUCH_SCREEN__ */

extern void gui_virtual_keyboard_clear_cache_on_imc_disconnect(gui_virtual_keyboard_struct *v);
extern void gui_virtual_keyboard_clear_state_on_imc_disconnect(gui_virtual_keyboard_struct *v);

/*******************************************************************************************
*those function is for cosmos VK
*/

/********************************************************************************************/
#endif/*__MMI_UI_VIRTUAL_KEYBOARD_DEFAULT_VERSION_3__*/


#endif /* #if defined(__MMI_VIRTUAL_KEYBOARD__) */
#endif /* __GUI_VIRTUAL_KEYBOARD_H__ */ 


